@{
    Layout = "_Layout";
}
@{
    ViewData["Title"] = "Albums";
}

@{
    Layout = "_Layout";
}
@{
    ViewData["Title"] = "Albums";
}

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Albums</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-3">
    <h2>Albums</h2>
    <div id="albums-container"></div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        // Make HTTP request to API endpoint
        $.get("/api/albums", function(albums) {
            // Check if albums are available
            if(albums.length === 0) {
                $("#albums-container").html("<p>No albums found</p>");
                return;
            }
            
            // Iterate through albums and render in cards
            albums.forEach(function(album) {
                var albumCard = `
                <div class="card mb-3">
                    <div class="card-header">
                        <h4 class="card-title">${album.nomAlbum}</h4>
                    </div>
                    <div class="card-body">
                        <img class="card-img-top" src="${album.image}" alt="${album.nomAlbum}" style="width:100%">
                        <h5 class="mt-2">Chansons:</h5>
                        <ul id="songs-${album.idAlbum}" class="list-group">
                            <!-- Songs will be dynamically added here -->
                        </ul>
                        <button class="btn btn-primary mt-2" onclick="loadMoreSongs(${album.idAlbum})">See More Songs</button>
                    </div>
                </div>`;
                $("#albums-container").append(albumCard);

                // Load initial songs for the album
                loadSongs(album.idAlbum, 3);
            });
        }).fail(function(xhr, textStatus, errorThrown) {
            // Handle API request failure
            $("#albums-container").html("<p>Error loading albums. Please try again later.</p>");
            console.error(xhr, textStatus, errorThrown);
        });
    });

    // Function to load songs for a specific album
    function loadSongs(albumId, count) {
        $.get(`/api/albums/${albumId}`, function(album) {
            if(!album) {
                console.error("Album not found");
                return;
            }

            $.get(`/api/albums/${albumId}/songs?count=${count}`, function(songs) {
                var songList = "";
                songs.forEach(function(song) {
                    songList += `<li class="list-group-item">${song.title}</li>`;
                });
                $("#songs-" + albumId).html(songList);
            }).fail(function(xhr, textStatus, errorThrown) {
                console.error("Error loading songs", xhr, textStatus, errorThrown);
            });
        }).fail(function(xhr, textStatus, errorThrown) {
            console.error("Error loading album", xhr, textStatus, errorThrown);
        });
    }

    // Function to load more songs for a specific album
    function loadMoreSongs(albumId) {
        loadSongs(albumId, 5); // Load 5 more songs
    }
</script>


</body>
</html>

